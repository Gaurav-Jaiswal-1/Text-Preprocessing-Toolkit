[tox]
envlist = py38, py39, py310, py311, lint, type-check, docs
skipsdist = True  # Skip building the package

[testenv]
description = Run tests with pytest
deps =
    pytest>=7.2.0
    pytest-cov>=4.0.0
commands =
    pytest --cov=text_preprocessing_toolkit --cov-report=term-missing --cov-report=html

[testenv:lint]
description = Run linting with flake8 and code formatting checks with black
deps =
    flake8>=6.0.0
    black>=23.1.0
commands =
    flake8 text_preprocessing_toolkit tests  # Ensure both source and tests are linted
    black --check text_preprocessing_toolkit tests  # Check formatting only

[testenv:type-check]
description = Run type checking with mypy
deps =
    mypy>=0.991
commands =
    mypy text_preprocessing_toolkit --check-untyped-defs --ignore-missing-imports  # Enhanced mypy config

[testenv:docs]
description = Build documentation using Sphinx
deps =
    sphinx>=7.1.2
    sphinx-rtd-theme>=1.2.0
commands =
    # Ensure the docs directory exists
    python -c "import os; assert os.path.exists('docs'), 'Docs directory not found!'"
    # Clean previous builds
    python -c "import shutil; shutil.rmtree('build/docs', ignore_errors=True)"
    # Build the documentation
    sphinx-build -b html docs/ build/docs

[tool:pytest]
addopts = --maxfail=3 --disable-warnings
testpaths = tests

[coverage:run]
branch = True
source = text_preprocessing_toolkit

[coverage:report]
fail_under = 80
show_missing = True

[coverage:html]
directory = htmlcov

[flake8]
max-line-length = 88
exclude = .tox,.git,__pycache__,docs,build,dist,*.egg-info,env

[mypy]
files = text_preprocessing_toolkit
ignore_missing_imports = True
check_untyped_defs = True
